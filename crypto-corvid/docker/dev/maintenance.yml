version: "3"
services:
  migrate:
    image: crypto_corvid_laravel
    env_file:
      - ../../src/.env
    command: php artisan migrate
    environment:
      - DB_HOST=db
    volumes:
      - ../../src:/crypto-app
    depends_on:
      - db

  seed:
    image: crypto_corvid_laravel
    env_file:
      - ../../src/.env
    command: php artisan db:seed
    environment:
      - DB_HOST=db
    volumes:
      - ../../src:/crypto-app
    depends_on:
      - db
        
  composer:
    image: crypto_corvid_backend
    env_file:
      - ../../src/.env
    entrypoint: composer
    command: install
    volumes:
      - ../../src:/crypto-app

  wallet-explorer:
    image: crypto_corvid_backend
    entrypoint: ["./wait-for-it.sh", "graylog:9000", "-s", "-t", "120", "--", "php", "artisan"]
    env_file:
      - ../../src/.env
    command: fetch_wallet_explorer
    volumes:
      - ../../src:/crypto-app
    depends_on:
      - db
      - graylog